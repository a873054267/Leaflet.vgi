webpackJsonp([1],{"+6Yy":function(t,n){},0:function(t,n,i){i("j1ja"),t.exports=i("NHnr")},"4FjD":function(t,n,i){"use strict";(function(t){var e=i("TWjZ");n.a={props:{open:{type:Boolean,default:!1}},mounted:function(){var n=t.tdtMap,i=t.latLng(39.899994,116.359),a=t.latLng(39.898983,116.36043),s=t.latLng(39.90004,116.35799),o=t.latLng(39.90259,116.3514),r=t.latLng(39.905132,116.349815),l=t.latLng(39.900948,116.35805),c=t.latLng(39.90004,116.35799),h=t.latLng(39.90447,116.35134);this.polyline=new e.a.PolyLine(n,{latLngs:[[i,a,s,o],[r,l,c,h]]})},methods:{beginDraw:function(){if(!this.open){this.$emit("beginDraw",!0);var t=this;this.polyline.drawNewLine({callback:function(){t.$emit("beginDraw",!1)}})}}}}}).call(n,i("nrd6"))},"5iT/":function(t,n){},"7VKB":function(t,n,i){"use strict";(function(t){var e=i("EYnv");i.n(e);n.a={name:"Map",mounted:function(){this.init()},methods:{init:function(){t.TileLayer.TdtLayer=t.TileLayer.extend({getTileUrl:function(t){return"http://t0.tianditu.gov.cn/DataServer?T=img_w&x="+t.x+"&y="+t.y+"&l="+t.z}});var n=t.tdtMap=t.map("map",{center:t.latLng(39.9,116.36),zoom:17,worldCopyJump:!0,minZoom:1,maxZoom:18,maxBounds:t.latLngBounds(t.latLng(-90,-360),t.latLng(90,360)),attributionControl:!1,zoomControl:!1,doubleClickZoom:!1}),i=new t.TileLayer.TdtLayer;n.addLayer(i),this.$emit("initMap",n)}}}}).call(n,i("nrd6"))},EYnv:function(t,n){},GUM2:function(t,n,i){"use strict";(function(t){var e=i("OvRC"),a=i.n(e);n.a={isOnLine:function(n,i){for(var e=0,a=n.length;e<a;e++){var s=n[e];if(s.x===i.x&&s.y===i.y)return!0;if(e+1===a)return!1;var o=n[e+1];if(t.LineUtil.pointToSegmentDistance(i,s,o)<=1)return!0}return!1},getTrianglePoints:function(t,n,i){var e=i-2,s=a()(null);s.x=(t.x+n.x)/2,s.y=(t.y+n.y)/2;var o=t.y-n.y,r=n.x-t.x,l=void 0;l=0===r?Math.PI/2:Math.atan(Math.abs(o)/Math.abs(r)),s.x=t.x+Math.abs(t.x-s.x),s.y=t.y-Math.abs(t.y-s.y);var c=a()(null);c.x=s.x-e*Math.cos(l),c.y=s.y+e*Math.sin(l);var h=a()(null);h.x=s.x+e*Math.cos(l),h.y=s.y-e*Math.sin(l);var f=a()(null);f.x=s.x+e*Math.sin(l),f.y=s.y+e*Math.cos(l);var u=a()(null);return u.x=s.x-e*Math.sin(l),u.y=s.y-e*Math.cos(l),o>=0&&r<0?(h.x=t.x-(h.x-t.x),f.x=t.x-(f.x-t.x),u.x=t.x-(u.x-t.x)):o<0&&r<=0?(h.x=t.x-(h.x-t.x),h.y=t.y+(t.y-h.y),f.x=t.x-(f.x-t.x),f.y=t.y+(t.y-f.y),u.x=t.x-(u.x-t.x),u.y=t.y+(t.y-u.y)):o<0&&r>0&&(h.y=t.y+(t.y-h.y),f.y=t.y+(t.y-f.y),u.y=t.y+(t.y-u.y)),{top:h,right:f,left:u}},isInBounds:function(t,n,i){if(t.x>=n.x-i&&t.x<=n.x+i&&t.y>=n.y-i&&t.y<=n.y+i)return!0}}}).call(n,i("nrd6"))},NHnr:function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var e=i("7+uW"),a=i("7VKB"),s={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{attrs:{id:"map"}})},staticRenderFns:[]};var o=function(t){i("QA8f")},r=i("VU/8")(a.a,s,!1,o,null,null).exports,l=i("4FjD"),c={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"d-item",on:{click:this.beginDraw}},[this._v("标线")])},staticRenderFns:[]};var h=function(t){i("+6Yy")},f={components:{DrawLine:i("VU/8")(l.a,c,!1,h,null,null).exports},data:function(){return{open:!1}},methods:{beginDraw:function(t){this.open=t}}},u={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{staticClass:"drawNav"},[n("DrawLine",{attrs:{open:this.open},on:{beginDraw:this.beginDraw}})],1)},staticRenderFns:[]};var d={name:"App",components:{Map:r,Nav:i("VU/8")(f,u,!1,function(t){i("5iT/")},null,null).exports},data:function(){return{show:!1}},methods:{initMap:function(t){this.show=!0}}},g={render:function(){var t=this.$createElement,n=this._self._c||t;return n("div",{attrs:{id:"app"}},[n("Map",{on:{initMap:this.initMap}}),this._v(" "),this.show?n("Nav"):this._e()],1)},staticRenderFns:[]};var v=i("VU/8")(d,g,!1,function(t){i("e+iC")},null,null).exports;e.a.config.productionTip=!1,new e.a({el:"#app",components:{App:v},template:"<App/>"})},QA8f:function(t,n){},TWjZ:function(t,n,i){"use strict";(function(t){var e=i("Gu7T"),a=i.n(e),s=i("Dd8w"),o=i.n(s),r=i("BO1k"),l=i.n(r),c=i("GUM2"),h=new t.Evented,f=void 0,u=0,d={circleBuffer:14,lineBuffer:9,end:{backStyle:{radius:9,fillColor:"#E20100"},frontStyle:{radius:6,fillColor:"#FFFFFF",color:"#3388ff"}},middle:{backStyle:{radius:7,fillColor:"#E20100"},frontStyle:{radius:4,fillColor:"#FFFFFF",color:"#3388ff"}},link:{backStyle:{radius:8},frontStyle:{fillColor:"#fffd0c",color:"#000000",radius:5}},animation:{circle:{beforeStyle:{radius:10,fillOpacity:.5},afterStyle:{radius:14,fillOpacity:.8},defaultStyle:{radius:9,fillOpacity:0}},line:{beforeStyle:{weight:14,opacity:.5},afterStyle:{weight:19,opacity:.8},defaultStyle:{opacity:0}}},triangle:{color:"#4e4e4e",weight:1,fillColor:"#fff",fillOpacity:.8,pane:"markerPane"}},g=function(t){var n=[],i=!0,e=!1,a=void 0;try{for(var s,o=l()(t);!(i=(s=o.next()).done);i=!0){var r=s.value,c=f.latLngToContainerPoint(r);n.push(c)}}catch(t){e=!0,a=t}finally{try{!i&&o.return&&o.return()}finally{if(e)throw a}}return n},v={twinkle:function(t){var n=this;f.fire("click"),this.toggle=!1;var i=this;this.setAnimationBeforeStyle(),this.intervalTimer=setInterval(function(){i.toggle?n.setAnimationBeforeStyle():n.setAnimationAfterStyle(),i.toggle=!i.toggle},1e3),this.hoverEventOff(),f.once("click",this.cancelTwinkle.bind(this)),"line"==t&&this.attach.drawTriangles()},cancelTwinkle:function(){this.intervalTimer&&(clearInterval(this.intervalTimer),this.intervalTimer=null,this.setAnimationDefaultStyle(),this.hoverEventRegister(),this.attach.triangles.remove())}},m={initialize:function(n){this.id=++u,t.extend(this.backStyle,n.backStyle),t.extend(this.frontStyle,n.frontStyle);var i=n.shapeFn,e=n.shapeCoors;this.back=i(e,this.backStyle),f.addLayer(this.back),this.front=i(e,this.frontStyle),f.addLayer(this.front),this.attach=n.attach,this.initEventParent()},initEventParent:function(){h.on("on-restoreClickEvent",this.clickEventRegister.bind(this))},eventRegister:function(){this.clickEventRegister(),this.hoverEventRegister()},clickEventRegister:function(){var t=this.getShapeType();this.twinkleBindFn=this.twinkle.bind(this,t),this.back.on("click",this.twinkleBindFn),this.front.on("click",this.twinkleBindFn)},hoverEventRegister:function(){var t=this;this.back.on("mouseover",function(){t.hover()}).on("mouseout",function(){t.out()}),this.front.on("mouseover",function(){t.hover()}).on("mouseout",function(){t.out()})},hoverEventOff:function(){this.back.off("mouseover").off("mouseout"),this.front.off("mouseover").off("mouseout")},getShapeType:function(){var t="line";return this instanceof k&&(t="circle"),t},setAnimationBeforeStyle:function(){var t=this.getShapeType(),n=d.animation[t].beforeStyle;this.back.setStyle(n),"circle"==t&&this.back.setRadius(n.radius)},setAnimationAfterStyle:function(){var t=this.getShapeType(),n=d.animation[t].afterStyle;this.back.setStyle(n),"circle"==t&&this.back.setRadius(n.radius)},setAnimationDefaultStyle:function(){var t=this.getShapeType(),n=d.animation[t].defaultStyle;this.back.setStyle(n),"circle"==t&&this.back.setRadius(n.radius)},cancelClickEvent:function(){this.back.off("click"),this.front.off("click")},remove:function(){this.attach=null,f.removeLayer(this.back),f.removeLayer(this.front)},move:function(){},setStyle:function(){}},L={backStyle:o()({},d.end.backStyle,{stroke:!1,fillOpacity:0,bubblingMouseEvents:!1}),frontStyle:o()({},d.end.frontStyle,{fillOpacity:1,weight:1,bubblingMouseEvents:!1}),initialize:function(n){this.latLng=n.latLng,this.type=n.type,n.shapeFn=t.circleMarker,n.shapeCoors=this.latLng,m.initialize.call(this,n)},eventRegister:function(){m.eventRegister.call(this),this.dragEventRegister()},dragEventRegister:function(){this.mouseDownFn=this.mouseDown.bind(this),this.back.on("mousedown",this.mouseDownFn),this.front.on("mousedown",this.mouseDownFn)},mouseDown:function(t){this.initPoint=t.containerPoint,f.dragging.disable(),f.fire("click");var n=this.latLng;this.front.bringToFront(),h.fire("on-getMoveIndexes",{params:{latLng:n}}),this.mousemoveFn=this.mouseMove.bind(this),f.on("mousemove",this.mousemoveFn),this.mouseupFn=this.mouseUp.bind(this),f.on("mouseup",this.mouseupFn)},mouseMove:function(t){var n=t.latlng,i=this;this.targetLine=null,h.fire("on-isLatLngInBuffer",{params:{latLng:n,callback:function(t,e){n=t,i.targetLine=e}}});var e=f.latLngToContainerPoint(n);c.a.isInBounds(e,this.initPoint,d.circleBuffer)||(this.move(n),h.fire("on-lineMoveByLatLng",{params:{latLng:n}}))},mouseUp:function(){f.off("mousemove",this.mousemoveFn),f.off("mouseup",this.mouseupFn),h.fire("on-restoreMoveIndexes"),this.sameCirclesToMerge(),f.dragging.enable()},sameCirclesToMerge:function(){var t=this.getCirclesInfo(this);t?this.circlesMerge(this,t,"link"):this.targetLine&&this.circleLineMerge(this)},getCirclesInfo:function(t){var n=t.latLng,i=void 0;return h.fire("on-isExistCircle",{params:{latLng:n,callback:function(n){i||(i=n.find(function(n){return t.id!=n.id}))}}}),i},circlesMerge:function(t,n,i){var e=t.latLng,a=n.attach.line.id;h.fire("on-removeExistCircle",{params:{circle:t}}),h.fire("on-removeExistCircle",{params:{circle:n}}),h.fire("on-insertCircle",{params:{type:i,latLng:e,lineId:a}})},circleLineMerge:function(t){var n=t.latLng,i="",e=this.targetLine.id;i=e===t.attach.line.id?"middle":"link",h.fire("on-removeExistCircle",{params:{circle:t}}),h.fire("on-insertLatLng",{params:{latLng:n}}),h.fire("on-insertCircle",{params:{type:i,latLng:n,lineId:e}})},move:function(t){this.back.setLatLng(t),this.front.setLatLng(t),this.latLng=t},setStyle:function(t){var n=t.backStyle,i=t.frontStyle;this.back.setStyle(n),this.front.setStyle(i),this.back.setRadius(n.radius),this.front.setRadius(i.radius)},hover:function(){var t=d.animation.circle.afterStyle;this.back.setStyle(t),this.back.setRadius(t.radius)},out:function(){var t=d.animation.circle.defaultStyle;this.back.setStyle(t),this.back.setRadius(t.radius)},remove:function(){this.latLng=null,m.remove.call(this)}},y={backStyle:{weight:14,color:"#e2200b",opacity:0,"stroke-linejoin":"round",bubblingMouseEvents:!1},frontStyle:{weight:3,color:"#ffffff",opacity:1,bubblingMouseEvents:!1},initialize:function(n){this.latLngs=n.latLngs,this.moveIndexes=[],n.shapeFn=t.polyline,n.shapeCoors=this.latLngs,m.initialize.call(this,n),this.initEvent()},initEvent:function(){h.on("on-isLatLngInBuffer",this.isLatLngInBuffer.bind(this)),h.on("on-insertLatLng",this.insertLatLng.bind(this)),h.on("on-getMoveIndexes",this.getMoveIndexes.bind(this)),h.on("on-lineMoveByLatLng",this.lineMoveByLatLng.bind(this)),h.on("on-restoreMoveIndexes",this.restoreMoveIndexes.bind(this))},isLatLngInBuffer:function(t){var n=t.params,i=n.latLng,e=n.callback,a=this.getClosetPoint(i);a&&e(f.containerPointToLatLng(a),this)},insertLatLng:function(n){for(var i=n.params.latLng,e=this.latLngs,a=f.latLngToContainerPoint(i),s=0,o=e.length;s<o;s++){var r=s+1;if(r<o){var l=f.latLngToContainerPoint(e[s]),c=f.latLngToContainerPoint(e[r]);if(a.x===l.x&&a.y===l.y||a.x===c.x&&a.y===c.y)continue;if(t.LineUtil.pointToSegmentDistance(a,l,c)<1)return e.splice(r,0,i),!0}}},getMoveIndexes:function(t){var n=t.params.latLng;this.moveIndexes=[];var i=f.latLngToContainerPoint(n),e=this;this.latLngs.forEach(function(t,n){var a=f.latLngToContainerPoint(t);c.a.isInBounds(i,a,d.circleBuffer)&&e.moveIndexes.push(n)})},lineMoveByLatLng:function(t){var n=t.params.latLng;if(0!==this.moveIndexes.length){for(var i in this.moveIndexes){var e=this.moveIndexes[i];this.latLngs[e]=n}this.redraw(this.latLngs)}},restoreMoveIndexes:function(){this.moveIndexes=[]},getClosetPoint:function(n){for(var i=f.latLngToContainerPoint(n),e=g(this.latLngs),a=e.length,s=void 0,o=0;o<a;o++){var r=e[o];if(!this.moveIndexes.includes(o)&&c.a.isInBounds(i,r,d.circleBuffer)){s=r;break}if(o+1===a)break;if(!this.moveIndexes.includes(o)&&!this.moveIndexes.includes(o+1)){var l=e[o+1];if(t.LineUtil.pointToSegmentDistance(i,r,l)<=d.lineBuffer){s=t.LineUtil.closestPointOnSegment(i,r,l);break}}}return s},redraw:function(t){this.back.setLatLngs(t),this.front.setLatLngs(t),this.latLngs=t},addLatLng:function(t){this.redraw([].concat(a()(this.latLngs),[t]))},move:function(t){this.back.setLatLngs([].concat(a()(this.latLngs),[t])),this.front.setLatLngs([].concat(a()(this.latLngs),[t]))},hover:function(){this.back.setStyle(d.animation.line.beforeStyle)},out:function(){this.back.setStyle(d.animation.line.defaultStyle)},remove:function(){this.latLngs=[],m.remove.call(this)}},p={initialize:function(t){this.latLngs=t,this.redrawTrianglesBindFn=this.redraw.bind(this),f.on("zoomend",this.redrawTrianglesBindFn)},redraw:function(t){t&&(this.latLngs=t),this.remove(),this.addTriangles()},addTriangles:function(){for(var n=void 0,i=void 0,e=[],a=this.latLngs,s=g(a),o=0;o<s.length;o++)if(n=s[o],o!=s.length-1){i=s[o+1];var r=c.a.getTrianglePoints(n,i,d.lineBuffer),l=r.top,h=r.right,u=r.left,v=f.containerPointToLatLng(l),m=f.containerPointToLatLng(h),L=f.containerPointToLatLng(u),y=t.polygon([v,m,L],d.triangle);e.push(y)}this.triangleLayerGroup=t.layerGroup(e),f.addLayer(this.triangleLayerGroup)},remove:function(){this.triangleLayerGroup&&(f.removeLayer(this.triangleLayerGroup),this.triangleLayerGroup=null),f.off("zoomend",this.redrawTrianglesBindFn)}},b={initialize:function(t){this.line=null,this.circles=[],this.triangles=null,this.initEvent()},initEvent:function(){h.on("on-cancelClickEvent",this.cancelClickEvent.bind(this)),h.on("on-isExistCircle",this.isExistCircle.bind(this)),h.on("on-removeExistCircle",this.removeExistCircle.bind(this)),h.on("on-insertCircle",this.insertCircle.bind(this))},cancelClickEvent:function(){this.line&&this.line.cancelClickEvent(),this.circles.forEach(function(t){t.cancelClickEvent()})},isExistCircle:function(t){var n=t.params,i=n.latLng;(0,n.callback)(this.circles.filter(function(t){var n=f.latLngToContainerPoint(t.latLng),e=f.latLngToContainerPoint(i);return c.a.isInBounds(e,n,d.circleBuffer)}))},removeExistCircle:function(t){var n=t.params.circle,i=this.circles,e=i.findIndex(function(t){return n.id==t.id});e>-1&&(i.splice(e,1),n.remove())},insertCircle:function(t){var n=t.params,i=n.latLng,e=n.type,a=n.lineId;if(this.line.id==a){var s=new k(o()({attach:this,type:e,latLng:i},d[e]));s.eventRegister(),this.circles.push(s)}},getClosetLatLng:function(t){return this.broadcastToLines(t,function(n){t=n}),t},isFinished:function(t){if(!this.line)return!1;var n=this.line.latLngs,i=n[n.length-1],e=f.latLngToContainerPoint(i),a=f.latLngToContainerPoint(t);return!!c.a.isInBounds(a,e,d.circleBuffer)},drawCompleted:function(){h.fire("on-drawComplete"),this.completeCommon(),this.drawTriangles(),this.line.twinkle("line")},completeCommon:function(){this.ball.remove(),this.ball=null,this.resetEndPointStyle(),this.circles.forEach(function(t){return t.eventRegister()}),this.line.eventRegister(),h.fire("on-restoreClickEvent")},drawTriangles:function(){this.triangles||(this.triangles=new w(this.line.latLngs)),this.triangles.redraw(this.line.latLngs)},resetEndPointStyle:function(){var t=this.circles.length,n=this.circles[t-1];if("middle"==n.type){var i=this.line.latLngs,e=g(i),a=f.latLngToContainerPoint(n.latLng);(t<=2||!c.a.isOnLine(e.slice(0,t-1),a))&&(n.type="end"),n.setStyle(d[n.type])}},drawOld:function(t){for(var n in t)this.draw(t[n]);this.completeCommon()},draw:function(t){this.line||(t=this.getClosetLatLng(t)),this.isFinished(t)?this.drawCompleted():(this.drawLine(t),this.drawCircle(t),this.drawBall(t))},drawLine:function(t){this.line?this.line.addLatLng(t):this.line=new C({latLngs:[t],attach:this})},drawCircle:function(t){var n=null,i="",e=this.getExistCircleByLatLng(t);if(e.length>0){if(n=e[0],this.circles.findIndex(function(t){return t.id==n.id})>-1)return n.type="middle",void n.setStyle(d.middle);i="link",t=n.latLng,h.fire("on-removeExistCircle",{params:{circle:n}})}else if("link"===(i=this.getCircleType(t))){h.fire("on-insertLatLng",{params:{latLng:t}})}var a=new k(o()({attach:this,type:i,latLng:t},d[i]));this.circles.push(a)},drawBall:function(t){this.ball||(this.ball=new k({type:"end",latLng:t}))},getExistCircleByLatLng:function(t){var n=[];return h.fire("on-isExistCircle",{params:{latLng:t,callback:function(t){n=n.concat(t)}}}),n},getCircleType:function(t){var n=!1;return this.broadcastToLines(t,function(t,i){n||i.length>1&&(n=!0)}),0===this.circles.length?"end":n?"link":"middle"},broadcastToLines:function(t,n){var i=[];h.fire("on-isLatLngInBuffer",{params:{latLng:t,callback:function(n,e){n&&(t=n),i.push(e)}}}),n(t,i)},autoMoveToLine:function(t){var n=this;this.broadcastToLines(t,function(t){n.line.move(t),n.ball.move(t)})}},x={initialize:function(t,n){var i=this;f=t,(n.latLngs||[]).forEach(function(t){i.draw(t)}),this.initEvent()},initEvent:function(){var t=this;h.on("on-drawComplete",function(){t.mapEventOff(),t.callback&&t.callback()})},draw:function(t){t&&0!=t.length&&(new S).drawOld(t)},drawNewLine:function(t){this.callback=t.callback,h.fire("on-cancelClickEvent");var n=new S;this.mapClickFn=this.mapClick.bind(this,n),this.mouseMoveFn=null,f.on("click",this.mapClickFn,this)},mapClick:function(t,n){var i=n.latlng;t.ball&&(i=t.ball.latLng),t.draw(i),this.mouseMoveFn||(this.mouseMoveFn=this.mapMouseMove.bind(this,t),f.on("mousemove",this.mouseMoveFn,this))},mapMouseMove:function(t,n){var i=n.latlng;t.autoMoveToLine(i)},mapEventOff:function(){f.off("click",this.mapClickFn,this),f.off("mousemove",this.mouseMoveFn,this)}},k=t.Class.extend(v).extend(m).extend(L),C=t.Class.extend(v).extend(m).extend(y),w=t.Class.extend(p),S=t.Class.extend(b),T=t.Class.extend(x);n.a={PolyLine:T}}).call(n,i("nrd6"))},"e+iC":function(t,n){}},[0]);
//# sourceMappingURL=main.acc89a4ac7c72534879b.js.map